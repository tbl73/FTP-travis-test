dist: trusty
sudo: false
language: ruby
cache: bundler

rvm:
  - 2.2.0

jobs:
  include:
    - stage: pretest
      before_install:
        - bash travis/.travis_pry.sh
      install: skip
      script: skip
    - stage: test
        rvm: 2.2.0
        env: DB=mysql
        gemfile: Gemfile
#    - rvm: 2.2.0
#      env: DB=mysql
#      gemfile: gemfiles/Gemfile.mysql57
#    - rvm: 2.2.0
#      env: DB=mysql57
#      gemfile: gemfiles/Gemfile.mysql57
#    - rvm: 2.2.0
#      addons:
#        mariadb: '10.0'
#      env: DB=mariadb
#      gemfile: Gemfile
#    - rvm: 2.2.0
#      addons:
#        mariadb: '10.0'
#      env: DB=mariadb
#      gemfile: gemfiles/Gemfile.mysql57

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install ghostscript
  - sudo apt-get install graphviz
  - bash travis/.travis_setup.sh

before_script:
  - bundle exec rake db:create
  - bundle exec rake db:migrate
  - bundle exec rake db:fixtures:load FIXTURES_PATH=spec/fixtures

script:
  - xvfb-run bundle exec rspec spec/features/

branches:
  only:
    - master
    - ui-design
    - fromthepage.com
    - indianapolis